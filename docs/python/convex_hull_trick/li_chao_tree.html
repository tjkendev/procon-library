<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Convex Hull Trick (Li-Chao (Segment) Tree) - 実装メモ</title>
<link rel="stylesheet" href="https://tjkendev.github.io/procon-library/src/stylesheet/github.css">
<script type="text/javascript" src="https://tjkendev.github.io/procon-library/src/javascript/main.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<link rel="stylesheet" href="https://tjkendev.github.io/procon-library/src/stylesheet/custom.css">

<style>
  .click .title { color: blue; }
  .click {margin-top: 0.5em; margin-bottom: 0.5em;}
  .openblock { margin-top: 1em; margin-bottom: 1em; }
  .openblock>.box>.content { margin-top:1em;margin-bottom: 1em;margin-left:3em;margin-right:4em; }
</style>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

<script>



var ready2;

ready2 = function() {

    $(document).ready(function(){

        $('.openblock.click').click( function()  { $(this).find('.content').slideToggle('200'); } )
        $('.openblock.click').find('.content').hide()


        $('.listingblock.click').click( function()  { $(this).find('.content').slideToggle('200') }  )
        $('.listingblock.click').find('.content').hide()

    });

}




$(document).ready(ready2);
$(document).on('page:load', ready2);


</script>

</head>


<body class="article">
<div id="header">
<h1>Convex Hull Trick (Li-Chao (Segment) Tree)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_概要">概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Li-Chao (Segment) Treeはセグメント木を用いてConvex Hull Trickを行うアルゴリズム。</p>
</div>
<div class="paragraph">
<p>詳細はこちら(ブログ): <a href=http://smijake3.hatenablog.com/entry/2018/06/16/144548>Li Chao Treeのメモ</a></p>
</div>
<div class="paragraph">
<p>直線を管理するセグメント木は一回の追加とクエリ処理が\(O(\log N)\)、線分を管理するセグメント木は一回の追加が\(O(\log^2 N)\)で一回のクエリ処理が\(O(\log N)\)になる。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_実装">実装</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Li Chao Tree

N0 = 2**(M-1).bit_length()
data = [None]*(2*N0+1)

X = [10**10]*N0 # N0に持つ座標N個を入れる

def f(line, x):
    p, q = line
    return p*x + q

def _add_line(line, k, l, r):
    m = (l + r) // 2
    if data[k] is None:
        data[k] = line
        return
    lx = X[l]; mx = X[m]; rx = X[r-1]
    left = (f(line, lx) &lt; f(data[k], lx))
    mid = (f(line, mx) &lt; f(data[k], mx))
    right = (f(line, rx) &lt; f(data[k], rx))
    if left and right:
        data[k] = line
        return
    if not left and not right:
        return
    if mid:
        data[k], line = line, data[k]
    if left != mid:
        _add_line(line, 2*k+1, l, m)
    else:
        _add_line(line, 2*k+2, m, r)

# 直線のみに対応する場合のadd_line: O(log N)
def add_line(line):
    return _add_line(line, 0, 0, N0)

# 線分に対応する場合のadd_line: O(log^2 N)
def add_line(line, a, b):
    L = a + N0; R = b + N0
    a0 = a; b0 = b
    sz = 1
    while L &lt; R:
        if R &amp; 1:
            R -= 1
            b0 -= sz
            _add_line(line, R-1, b0, b0+sz)
        if L &amp; 1:
            _add_line(line, L-1, a0, a0+sz)
            L += 1
            a0 += sz
        L &gt;&gt;= 1; R &gt;&gt;= 1
        sz &lt;&lt;= 1

def query(k):
    x = X[k]
    k += N0-1
    s = 1e30
    while k &gt;= 0:
        if data[k]:
            s = min(s, f(data[k], x))
        k = (k - 1) // 2
    return s</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_verified">Verified</h3>
<div class="ulist">
<ul>
<li>
<p>直線処理</p>
<div class="ulist">
<ul>
<li>
<p>(TLE) CSAcademy: "Squared Ends": (Python3) <a href=https://csacademy.com/submission/1614823/>source</a></p>
</li>
<li>
<p>yukicoder: "No.703 ゴミ拾い Easy": (PyPy3) <a href=https://yukicoder.me/submissions/266174>source</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>線分処理</p>
<div class="ulist">
<ul>
<li>
<p>yukicoder: "No.704 ゴミ拾い Medium": (PyPy3) <a href=https://yukicoder.me/submissions/266423>source</a></p>
</li>
<li>
<p>CodeChef: "June Challenge 2018 - Archi and Tree": (PyPy2) <a href=https://www.codechef.com/viewsolution/18771280>source</a></p>
</li>
<li>
<p>CodeChef: "July Challenge 2018 - Pizza Delivery": (PyPy2) <a href=https://www.codechef.com/viewsolution/19144188>source</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><a href=../../index.html>戻る</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-09-18 01:22:25 JST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { extensions: ["mhchem.js"] }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>