= RSQ and RUQ (遅延伝搬セグメント木)
:title: {doctitle} - {pagetitle}

Range Sum Query and Range Update Query (RSQ and RUQ)

== 概要

以下のクエリが処理できる遅延伝搬セグメント木の実装

- $a_l, a_{l+1}, ..., a_{r-1}$ の値を $x$ に更新
- $a_l, a_{l+1}, ..., a_{r-1}$ の合計を求める

=== 具体的計算

遅延伝搬セグメント木(Segment Tree with Lazy Propagation)の実装では、
各区間Iには区間の値value[$I$]と遅延させている値lazy[$I$]を持たせる。

==== 区間更新

区間$I = [l, r)$の値更新処理では、以下を行う。

1. 更新する区間が含まれる全ての区間で遅延させている値lazyをトップダウンに伝搬
    - 自身が持っているlazy値を半分ずつ左右に値を代入していく
    - 伝搬させる区間は $2 \lceil \log N \rceil + 1$ 個以下
2. 区間$I$に含まれる(最小個の)区間の値を全て更新
    - value[$I$] = lazy[$I$] = x * (区間の長さ)
3. 更新する区間を含む全ての区間の値valueをボトムアップに更新
    - 遅延値を伝搬した1の区間の値を、左右の区間の和で更新

1回の区間更新の計算量は $O(\log N)$

==== 合計計算

区間$I = [l, r)$内の最小値計算は、以下のように行う。

1. 2の計算で参照する区間が含まれる全ての区間で遅延させている値lazyをトップダウンに伝搬
    - 自身が持っているlazy値を半分ずつ左右に値を代入していく
    - 伝搬させる区間は $2 \lceil \log N \rceil + 1$ 個以下
2. 区間$I$に含まれる(最小個の)区間の和を求める

1回の最小値の計算量は $O(\log N)$

== 実装

[source, python]
----
include::./python/range_query/rsq_ruq_segment_tree_lp.py[]
----

=== Verified

* AOJ: "DSL_2_I: Range Query - RSQ and RUQ": (Python3) link:http://judge.u-aizu.ac.jp/onlinejudge/review.jsp?rid=3161416#1[source]

***
link:../../index.html[戻る]